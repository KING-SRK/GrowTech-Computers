<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Creating Network Diagrams with Tools</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@4.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <link
      rel="stylesheet"
      href="../Compeuter css/Assembling & Disassembling Computers.css"
    />
    <link rel="stylesheet" href="../css/popup.css" />
  </head>

  <body>
    <button class="fixed-back-btn" onclick="history.back()">
      <i class="ri-arrow-left-s-line"></i>
    </button>

    <div class="page-header">
      <h1>Creating Network Diagrams with Tools</h1>
      <p>
        Tools Like Microsoft Visio or Cisco Packet Tracer to Map Network
        Infrastructure Components Like Routers, Switches, and Firewalls
      </p>
    </div>

    <div class="container">
      <form id="issue-form">
        <label for="name">Full Name:</label>
        <input
          type="text"
          id="name"
          name="name"
          required
          placeholder="Enter your full name"
        />

        <label for="phone">Mobile Number:</label>
        <input
          type="tel"
          id="phone"
          name="phone"
          required
          placeholder="Enter mobile number"
        />

        <label for="email">Email Address:</label>
        <input
          type="email"
          id="email"
          name="email"
          required
          placeholder="Enter email address"
        />

        <label for="address">Current Address:</label>
        <textarea
          id="address"
          name="address"
          required
          placeholder="Enter your current address"
          rows="3"
        ></textarea>

        <div style="text-align: right; margin-top: 5px; margin-bottom: 15px">
          <button
            type="button"
            onclick="getCurrentLocation()"
            style="
              font-size: 14px;
              background-color: #f2f2f2;
              color: #0a3c59;
              border: 1px solid #ccc;
              padding: 6px 12px;
              border-radius: 5px;
              cursor: pointer;
            "
          >
            üìç Use Current Location
          </button>
        </div>

        <label for="issue">Describe Your Issue:</label>
        <textarea
          id="issue"
          name="issue"
          required
          placeholder="Write your issue here"
          rows="5"
        ></textarea>

        <div style="text-align: center">
          <button type="submit">Submit Request</button>
        </div>
      </form>
    </div>

    <div class="popup-overlay" id="popup-overlay">
      <div class="popup-box">
        <h2 id="popup-title"></h2>
        <p id="popup-message"></p>
        <button id="popup-ok-btn">OK</button>
      </div>
    </div>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDI8FxDlILMR93AD69_E48qwMKJuSUqFXg",
        authDomain: "digital-solutions-ae7ad.firebaseapp.com",
        databaseURL:
          "https://digital-solutions-ae7ad-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "digital-solutions-ae7ad",
        storageBucket: "digital-solutions-ae7ad.appspot.com",
        messagingSenderId: "761041929019",
        appId: "1:761041929019:web:d228c928c6bd40ea4fed1e",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      // Function to show custom popup
      function showPopup(title, message) {
        document.getElementById("popup-title").innerText = title;
        document.getElementById("popup-message").innerHTML = message;
        document.getElementById("popup-overlay").style.display = "flex";
      }

      // Function to close custom popup
      function closePopup() {
        document.getElementById("popup-overlay").style.display = "none";
      }

      // OK button event listener
      document
        .getElementById("popup-ok-btn")
        .addEventListener("click", closePopup);

      document
        .getElementById("issue-form")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          // Save data under a date-specific reference
          const today = new Date().toISOString().split("T")[0]; // yyyy-mm-dd
          const data = {
            name: document.getElementById("name").value,
            phone: document.getElementById("phone").value,
            email: document.getElementById("email").value,
            address: document.getElementById("address").value,
            issue: document.getElementById("issue").value,
            timestamp: new Date().toISOString(),
          };

          db.ref("Creating Network Diagrams with Tools/" + today)
            .push(data)
            .then(() => {
              this.reset();
              showPopup(
                "‚úÖ Request Submitted",
                "Thank you for submitting your issue.<br />Our team will review your request and contact you shortly.<br />Please keep your phone nearby."
              );
            })
            .catch((error) => {
              showPopup("‚ùå Error", "Something went wrong: " + error.message);
            });
        });

      function getCurrentLocation() {
        if (!navigator.geolocation) {
          showPopup(
            "‚ùå Error",
            "Geolocation is not supported by your browser."
          );
          return;
        }

        navigator.geolocation.getCurrentPosition(
          function (position) {
            const lat = position.coords.latitude.toFixed(6);
            const lon = position.coords.longitude.toFixed(6);

            // Reverse geocoding with Nominatim API
            fetch(
              `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`
            )
              .then((response) => response.json())
              .then((data) => {
                if (data && data.display_name) {
                  document.getElementById("address").value = data.display_name;
                } else {
                  document.getElementById(
                    "address"
                  ).value = `Latitude: ${lat}, Longitude: ${lon}`;
                }
              })
              .catch(() => {
                document.getElementById(
                  "address"
                ).value = `Latitude: ${lat}, Longitude: ${lon}`;
              });
          },
          function (error) {
            showPopup(
              "‚ùå Error",
              "Unable to retrieve your location. Please allow location access."
            );
          }
        );
      }
    </script>
  </body>
</html>
